<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Брояч на продадени продукти (CSV от Excel)</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app">
    <header>
      <h1>Продажби от Excel → общо продадени бройки</h1>
      <p class="subtitle">
        Качете CSV файл (експортиран от Excel). Всичко се обработва локално в браузъра.
      </p>
    </header>

    <!-- Alerts -->
    <div id="alert" class="alert hidden" role="alert" aria-live="polite"></div>

    <!-- Dropzone -->
    <div id="dropzone" class="dropzone" tabindex="0" role="button" aria-label="Пуснете CSV файл тук или изберете от бутон">
      <div>
        <strong>Плъзнете и пуснете .csv тук</strong>
        <div class="hint">или натиснете бутона вдясно, за да изберете файл</div>
      </div>

      <label class="btn primary" for="fileInput">
        Избор на файл
        <input id="fileInput" class="visually-hidden" type="file" accept=".csv" />
      </label>
    </div>

    <!-- Filters -->
    <section class="controls" aria-label="Филтри">
      <div class="control sm-3">
        <label for="dateStart">Начална дата</label>
        <input type="date" id="dateStart" />
      </div>
      <div class="control sm-3">
        <label for="dateEnd">Крайна дата</label>
        <input type="date" id="dateEnd" />
      </div>
      <div class="control sm-3">
        <label for="groupSelect">Продуктова група</label>
        <select id="groupSelect" aria-label="Изберете продуктова група">
          <option value="">Всички</option>
        </select>
      </div>
      <div class="control sm-3">
        <label for="classSelect">Продуктов клас</label>
        <select id="classSelect" aria-label="Изберете продуктов клас">
          <option value="">Всички</option>
        </select>
      </div>
      <div class="control sm-3">
        <label for="searchInput">Търсене по продукт</label>
        <input type="text" id="searchInput" placeholder="Започнете да пишете..." />
      </div>
      <div class="control sm-3" style="display:flex;align-items:flex-end">
        <button id="clearFiltersBtn" class="btn ghost" type="button">Изчисти филтрите</button>
      </div>
    </section>

    <!-- Stats -->
    <section class="stats" aria-label="Статистика">
      <div class="stat fade-in">
        <div class="label">Общо бройки</div>
        <div id="totalQty" class="value">0</div>
      </div>
      <div class="stat fade-in">
        <div class="label">Уникални артикули</div>
        <div id="uniqueCount" class="value">0</div>
      </div>
      <div class="stat fade-in">
        <div class="label">Редове във файла</div>
        <div id="rowsAll" class="value">0</div>
      </div>
      <div class="stat fade-in">
        <div class="label">След филтър</div>
        <div id="rowsFiltered" class="value">0</div>
      </div>
    </section>

    <!-- Suggestions -->
    <section id="suggestionsSection" class="hidden" aria-label="Предложения">
      <div class="stats" style="margin-top:8px">
        <div class="stat">
          <div class="label">Бързооборотни (30 дни)</div>
          <div id="fastCount" class="value">0</div>
        </div>
        <div class="stat">
          <div class="label">Редове за преглед</div>
          <div id="issueCount" class="value">0</div>
        </div>
      </div>

      <div class="table-wrap" style="margin-top:10px">
        <div class="table-scroller">
          <table aria-label="Предложение за наличности">
            <thead>
              <tr>
                <th>Продукт</th>
                <th class="text-right">Продажби (30 дни)</th>
                <th class="text-right">Средно/ден</th>
                <th class="text-right">Предложена мин. наличност (14 дни)</th>
              </tr>
            </thead>
            <tbody id="suggestLoadBody">
              <tr><td colspan="4" class="empty">Няма предложения.</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="table-wrap" style="margin-top:10px">
        <div class="table-scroller">
          <table aria-label="Редове за преглед/отхвърляне">
            <thead>
              <tr>
                <th>Причина</th>
                <th>Продукт</th>
                <th class="text-right">Количество</th>
                <th>Дата</th>
              </tr>
            </thead>
            <tbody id="suggestDiscardBody">
              <tr><td colspan="4" class="empty">Няма проблемни редове.</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Results table -->
    <div class="table-wrap">
      <div class="table-scroller">
        <table id="resultsTable" aria-label="Разбивка по продукт">
          <thead>
            <tr>
              <th scope="col">Продукт</th>
              <th scope="col" class="text-right">Количество</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr><td colspan="2" class="empty">Качете CSV файл, за да видите резултатите.</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <footer>
      © 2025 • Локална обработка. Нужен е CSV (експорт от Excel). |
      <a href="README.md" target="_blank" rel="noopener">README</a>
    </footer>
  </div>

  <script src="app.js" defer></script>
</body>
</html>
